SET(FREEIMAGE_VERSION_MAJOR 3)
SET(FREEIMAGE_VERSION_MINOR 18)
SET(FREEIMAGE_VERSION_PATCH 0)
SET(FREEIMAGE_VERSION ${FREEIMAGE_VERSION_MAJOR}${FREEIMAGE_VERSION_MINOR}${FREEIMAGE_VERSION_PATCH})

SET(FREEIMAGE_PROJECT_DIR "${CMAKE_CURRENT_SOURCE_DIR}/../../../FreeImage")
SET(FREEIMAGE_OUTPUT_DIR "${EXTERNAL_PROJECT_DIR}/lib/FreeImage/${KLAYGE_PLATFORM_NAME}")
SET(REL_PATH "External/Downloads/FreeImage${FREEIMAGE_VERSION}.patched.7z")
SET(PACKAGE_FILE_ID "95A5613A7662AC4B49CA2D720366975AAA21F2CA")

DOWNLOAD_PACKAGE("FreeImage" ${REL_PATH} ${PACKAGE_FILE_ID})

IF(KLAYGE_COMPILER_MSVC)
	STRING(REPLACE "/WX" "/WX:NO" CMAKE_STATIC_LINKER_FLAGS ${CMAKE_STATIC_LINKER_FLAGS})
ELSEIF(KLAYGE_COMPILER_CLANG)
	SET(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -Wno-register -Wno-c++11-narrowing")
ENDIF()
FOREACH(flag_var
		CMAKE_CXX_FLAGS_RELEASE CMAKE_CXX_FLAGS_RELWITHDEBINFO CMAKE_CXX_FLAGS_MINSIZEREL)
	STRING(REPLACE "${NO_RTTI_FLAG}" "${RTTI_FLAG}" ${flag_var} "${${flag_var}}")
ENDFOREACH()

IF(KLAYGE_PLATFORM_WINDOWS)
	ADD_DEFINITIONS(-DWIN32)
ELSE()
	ADD_DEFINITIONS(-D__ANSI__)
ENDIF()

ADD_SUBDIRECTORY(FreeImage)
ADD_SUBDIRECTORY(LibJPEG)
ADD_SUBDIRECTORY(LibJXR)
ADD_SUBDIRECTORY(LibOpenJPEG)
ADD_SUBDIRECTORY(LibPNG)
ADD_SUBDIRECTORY(LibRaw)
ADD_SUBDIRECTORY(LibTIFF4)
ADD_SUBDIRECTORY(LibWebP)
ADD_SUBDIRECTORY(OpenEXR)
ADD_SUBDIRECTORY(ZLib)

foreach(target
	"FreeImage" "LibJPEG" "LibJXR" "LibOpenJPEG" "LibPNG" "LibRaw" "LibTIFF4" "LibWebP" "OpenEXR" "ZLib")
	set_target_properties(${target} PROPERTIES FOLDER "${EXTERNAL_VS_FOLDER_PREFIX}/FreeImage")
endforeach()
